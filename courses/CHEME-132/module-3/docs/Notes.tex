\documentclass[11pt]{article}

% load some asm stuff -
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
%\usepackage{palatino,lettrine}
\usepackage{fancyhdr}
\usepackage{epsfig}
\usepackage[square,sort,comma,numbers]{natbib}
\usepackage{simplemargins}
\usepackage{setspace}
\usepackage{wrapfig}
\usepackage{hyperref}
%\usepackage{boiboites}
\usepackage[margin=0pt,font=small,labelfont=bf]{caption}
\newcommand{\boldindex}[1]{\textbf{\hyperpage{#1}}}
\usepackage{makeidx}\makeindex
\bibliographystyle{plos2015}

\usepackage{algpseudocode}
\usepackage{algorithm}


% Set the size
%\textwidth = 6.75 in
%\textheight = 9.75 in
%\oddsidemargin = 0.0 in
%\evensidemargin = 0.0 in
%\topmargin = 0.01 in
%\headheight = 0.0 in
%\headsep = 0.25 in
%\parskip = 0.15in
% \doublespace
\setallmargins{1in}

\newtheorem{example}{Example}[section]
\newtheorem{thm}{Theorem}[section]
\newtheorem{property}{Property}[section]

\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}

\makeatletter
% \renewcommand\subsection{\@startsection
% 	{subsection}{2}{0mm}
% 	{-0.05in}
% 	{0.05\baselineskip}
% 	{\normalfont\normalsize\bfseries}}
\renewcommand\subsubsection{\@startsection
	{subsubsection}{2}{0mm}
	{-0.05in}
	{-0.5\baselineskip}
	{\normalfont\normalsize\itshape\bfseries}}
\renewcommand\paragraph{\@startsection
	{paragraph}{2}{0mm}
	{-0.05in}
	{-0.5\baselineskip}
	{\normalfont\normalsize\itshape}}
\makeatother
\linespread{1.1}

\fancypagestyle{proposal}{\fancyhf{}%
	\fancyhead[RO,LE]{\thepage}%
	\fancyhead[LO,RE]{CHEME 132 Module 3 Multi Asset Geometric Brownian Motion}%
	\renewcommand\headrulewidth{1pt}}
\pagestyle{proposal}

\usepackage{mdframed}
\definecolor{lgray}{rgb}{0.92,0.92,0.92}
\definecolor{antiquewhite}{rgb}{0.98,0.92,0.84}
\definecolor{lightskyblue}{rgb}{0.93,0.95,0.99}

% defn environment
\mdfdefinestyle{theoremstyle}{% 
    linecolor=black,linewidth=1pt,% 
    frametitlerule=true,% 
    frametitlebackgroundcolor=lgray, 
    innertopmargin=\topskip,} 
\mdtheorem[style=theoremstyle]{definition}{Definition}

% concept environment
\mdfdefinestyle{conceptstyle}{% 
    linecolor=black,linewidth=1pt,% 
    frametitlerule=true,% 
    frametitlebackgroundcolor=lightskyblue, 
    innertopmargin=\topskip,} 
\mdtheorem[style=conceptstyle]{concept}{Concept}
\newcommand{\newterm}[1]{{\it #1}}

% Single space'd bib -
\setlength\bibsep{0pt}

\renewcommand{\rmdefault}{phv}\renewcommand{\sfdefault}{phv}
%\newboxedtheorem[boxcolor=black, background=gray!5,titlebackground=orange!20,titleboxcolor = black]{color_box_example}{Example}{test}

% Change the number format in the ref list -
\renewcommand{\bibnumfmt}[1]{#1.}

% Change Figure to Fig.
\renewcommand{\figurename}{Fig.}
\usepackage{enumitem}
\setlist{noitemsep} % or \setlist{noitemsep} to leave space around whole list

%Joycelyn Chan, Joshua Lequieu, Michael Paull, Chidanand Balaji, Ryan Tasseff
%Our derivation follows closely the earlier development of Fredrickson \citep{Fredrickson:1976fk}.

% Begin ...
\begin{document}

%\begin{titlepage}
{\par\centering\textbf{\Large CHEME 132 Module 3: Multiple Asset Geometric Brownian Motion}}
\vspace{0.2in}
{\par \centering \large{Jeffrey D. Varner}}
\vspace{0.05in}
{\par \centering \large{Smith School of Chemical and Biomolecular Engineering}}
{\par \centering \large{Cornell University, Ithaca NY 14853}}
% \vspace{0.1in}
% {\par \centering \small{Copyright \copyright\ Jeffrey Varner 2018. All Rights Reserved.}}\\

%\end{titlepage}
\date{}
\thispagestyle{empty}

\setcounter{page}{1}

\section*{Introduction}
\href{https://en.wikipedia.org/wiki/Geometric_Brownian_motion}{Geometric Brownian motion (GBM)} is a continuous-time stochastic model in which the random variable $S(t)$, 
e.g., the share price of a firm, is described by a stochastic differential equation.
Geometric Brownian motion was popularized as a financial model by Samuelson in the 1950s and 1960s \cite{Merton2006}, 
but is arguably most commonly associated with the Blackâ€“Scholes options pricing model, which we will describe later 
\cite{BlackScholes1973}. Previously, we considered the single asset GBM model, 
where the share price of a firm was modeled as a deterministic drift term that is corrupted by a Wiener noise process. 
We showed that the share price of a firm follows a log-normal distribution, and derived the analytical solution for the share price of a firm at a future time point.
However, in practice, investors often hold portfolios of assets, and the share price of a firm is correlated with the share price of other firms.
Thus, let's consider the GBM for multiple simulataneous assets, where the share price of a firm is modeled as a deterministic drift term 
that is corrupted by a Wiener noise process (same as before), but now we consider how the noise is correlated with other firms in a portfolio.

Consider an asset portfolio $\mathcal{P}$, e.g., a collection of equities with a logarithmic return covariance matrix $\Sigma$ and drift vector $\mu$.
The multi-dimensional geometric Brownian motion model describing the share price $S_{i}(t)$ for asset $i\in\mathcal{P}$ at time $t$ is given by: 
\begin{equation*}
\frac{dS_{i}\left(t\right)}{S_{i}(t)} = \mu_{i}\,{dt}+\sum_{j=1}^{\mathcal{P}}a_{ij}\cdot{dW_{j}(t)}\qquad\text{for}\quad{i=1,2,\dots,\mathcal{P}}
\end{equation*}
where $a_{ij}\in\mathbf{A}$ and $\mathbf{A}\mathbf{A}^{\top} = \Sigma$ are noise coefficients describing the connection between firms $i$ and firms $j$ in the portfolio $\mathcal{P}$,
and $\mu_{i}$ denotes the drift parameter for asset $i$ in the portfolio $\mathcal{P}$.
The multi-dimensional GBM model has the analytical solution:
\begin{equation*}
S_{i}(t_{k}) = S_{i}(t_{k-1})\cdot\exp\Biggl[\left(\mu_{i}-\frac{\sigma_{i}^{2}}{2}\right)\Delta{t} + \sqrt{\Delta{t}}\cdot\sum_{j\in\mathcal{P}}a_{ij}\cdot{Z_{j}(0,1)}\Biggr]\quad{i\in\mathcal{P}}
\end{equation*}
where $S_{i}(t_{k-1})$ is the share price for firm $i\in\mathcal{P}$ at time $t_{k-1}$,  the term $\Delta{t} = t_{k} - t_{k-1}$ denotes the time difference (step-size) 
for each time step (fixed), and $Z_{j}(0,1)$ is a standard normal random variable for firm $j\in\mathcal{P}$.

\section*{Drift and Covariance}
The drift vector $\mu$ and covariance matrix $\Sigma$ are key parameters in the multi-dimensional GBM model.
We can estimate the drift vector $\mu$, which will be a $\dim\mathcal{P}\times{1}$ vector, from historical data by computing the logarithmic excess growth rate of the assets in the portfolio $\mathcal{P}$, 
as we have shown previosly; we simply repeat the process for each asset in the portfolio $\mathcal{P}$.
On the other hand, the covariance matrix, a $\dim\mathcal{P}\times\dim\mathcal{P}$ symmetric matrix, describes the relationship between the logarithmic return series of firms $i$ and $j$.
The $(i,j)$ element of the covariance matrix $\sigma_{ij}\in\Sigma$ is given by:
\begin{equation*}
    \sigma_{ij} = \text{cov}\left(r_{i},r_{j}\right) = \sigma_{i}\sigma_{j}\rho_{ij}\qquad\text{for}\quad{i,j \in \mathcal{P}}
\end{equation*}
where $\sigma_{\star}$ denote the standard deviation of the logarithmic return of asset $\star$, i.e., the volatility parameter, and $\rho_{ij}$ 
denotes the correlation between the returns of asset $i$ and $j$ in the portfolio $\mathcal{P}$. The correlation is given by:
\begin{equation*}
\rho_{ij} = \frac{\mathbb{E}(r_{i}-\mu_{i})\cdot\mathbb{E}(r_{j} - \mu_{j})}{\sigma_{i}\cdot\sigma_{j}}\qquad\text{for}\quad{i,j \in \mathcal{P}}
\end{equation*}
where $\mathbb{E}(r_{i}-\mu_{i})$ is the expected value of the difference between the logarithmic return of asset $i$ and its drift parameter 
$\mu_{i}$, i.e., mean of the logorithmic return. The diagonal elements of the covariance matrix $\sigma_{ii}\in\Sigma$ are the variances, 
while the off-diagonal measure the relationship between assets $i$ and $j$ in the portfolio $\mathcal{P}$.

\begin{algorithm}[h]
    \caption{Logarithmic Excess Growth Rate}\label{algo-log-return-distributions-equity}
    \begin{algorithmic}[1]

        \Statex
        \Require data set $\mathcal{D}_{i} = \left\{S_{i,t}\right\}_{t=1}^{N}\in\mathcal{D}$ where $S_{i,t}$ denotes the price of stock $i$ at time $t$, all stocks have the same time horizon $N\gg{2}$, 
		and $\mathcal{D}$ denotes the data set of all stocks.
        \Require The time interval $\Delta{t}$ between $t$ and $t-1$ (units: years), and a list of stocks $\mathcal{L} = \left\{i\right\}_{i=1}^{M}$ where $M = \dim\mathcal{L}$.
        \Require The risk-free rate $r_{f}$ (units: inverse years).
     
        \Statex
		\Procedure{log growth rate}{$\mathcal{D}$, $\mathcal{L}$, $\Delta{t}$, $r_{f}$}
		\State{$N\leftarrow\text{length}(\mathcal{D})$}\Comment{Number of trading days for each stock $i\in\mathcal{L}$}
        \For{$i\in\mathcal{L}$}
			\State{$\mathcal{D}_{i} \gets \mathcal{D}[i]$}\Comment{Select the data for stock $i$ from the dataset collection $\mathcal{D}$}
            \For{$t=2\rightarrow{N}$}
                \State{$S_{i,t-1} \gets \mathcal{D}_{i}[t-1]$}\Comment{Select the price of stock $i$ at time $t-1$}
                \State{$S_{i,t} \gets \mathcal{D}_{i}[t]$}\Comment{Select the price of stock $i$ at time $t$}
                \State{$\mu^{(i)}_{t,t-1} \gets \left(1/\Delta{t}\right)\cdot\ln\left(S_{i,t}/{S_{i,t-1}}\right) - r_{f}$}\Comment{Set $r_{f} = 0$ for regular growth rate}
            \EndFor
        \EndFor
        \Statex
        \Return{$\mu^{(1)},\dots,\mu^{(\dim\mathcal{L})}$}\Comment{Return the logarithmic growth rate array for each stock $i\in\mathcal{L}$}
		\EndProcedure
    \end{algorithmic}
\end{algorithm}

\subsection*{Estimating the noise coefficients $a_{ij}$}
The noise coefficients $a_{ij}$ modify the noise terms in the multi-dimensional GBM model, 
and describe the connection between firms $i$ and firms $j$ in the portfolio $\mathcal{P}$. 
The noise coefficients are given by the Cholesky decomposition of the covariance matrix $\Sigma$:
\begin{equation*}
\Sigma = \mathbf{A}\mathbf{A}^{\top}
\end{equation*}
where $\mathbf{A}$ is a lower triangular matrix. 
The Cholesky decomposition is a matrix factorization that decomposes the covariance matrix $\Sigma$ 
into the product of a lower triangular matrix $\mathbf{A}$ and its complex conjugate transpose $\mathbf{A}^{\top}$;
given that $\Sigma$ is a positive-definite matrix, the Cholesky decomposition is unique.

\section*{Multiasset Simulation}
Now that we have estimated the drift vector $\mu$, the covariance matrix $\Sigma$, and the noise coefficients $a_{ij}$, we can
simulate the multi-dimensional GBM model to predict the share price of a firm at a future time point. 
Much like the single asset GBM model, we can simulate the multi-dimensional GBM model using the analytical solution, 
except in this case we will simulate the share price of each firm in the portfolio $\mathcal{P}$ at each time point.
Thus, we'll need a vector of initial share prices $\mathbf{S}(t_{0})$, the drift vector $\mu$, the covariance matrix $\Sigma$,
along with user-defined time points $t_{0},t_{1},\dots,t_{N}$, and the number of samples to simulate $N_{\text{samples}}$.
Given this data, we can use the following algorithm to simulate the multi-dimensional GBM model (Algorithm \ref{algo-multi-asset-gbm-simulation}).


\begin{algorithm}[h]
    \caption{Multiasset Geometric Brownian Motion}\label{algo-multi-asset-gbm-simulation}
    \begin{algorithmic}[1]
		\Statex
		\Require The initial share price vector $\mathbf{S}(t_{0}) = \left\{S_{i}(t_{0})\right\}_{i=1}^{\dim\mathcal{P}}$ for each firm $i\in\mathcal{P}$.
		\Require The drift vector $\mu = \left\{\mu_{i}\right\}_{i=1}^{\dim\mathcal{P}}$ for each firm $i\in\mathcal{P}$.
		\Require The covariance matrix $\Sigma$ for the portfolio $\mathcal{P}$.
		\Require The time step $\Delta{t}$ (units: years), the initial time $t_{\circ}$, the final time $t_{f}$, and the number of samples $N_{s}$.
		\Require A Cholesky decomposition function $\texttt{cholesky}(\Sigma)$ that returns the Cholesky factor $\mathbf{A}$.

		\Statex
		\Procedure{Multiasset GBM}{$\mu$, $\Sigma$, $\mathbf{S}_{\circ}$, $(t_{\circ}, t_{f}, \Delta{t})$, $N_{\text{samples}}$}
		\Statex
		\State{$N_{a} \gets \text{length}(\mu)$}\Comment{Number of assets in the portfolio $\mathcal{P}$}
		\State{$N_{t} \gets (t_{f} - t_{\circ})/\Delta{t}$}\Comment{Number of time steps}
		\State{$T \gets \texttt{arange}(t_{\circ},t_{f},\Delta{t})$}\Comment{Time points}
		\State{$X \gets \texttt{zeros}(N_{s},N_{t}, N_{a}+1)$}\Comment{Pre-allocate the share price array}
		\State{$\mathcal{Z} \gets \mathcal{N}(0,1)$}\Comment{Instantiate a standard normal distribution}
		\State{$\mathbf{A} \gets \texttt{cholesky}(\Sigma)$}\Comment{Cholesky decomposition of the covariance matrix $\Sigma$}
		
		
		\Statex
		\For{$i\in{1}~\text{to}~{N_{s}}}$\Comment{Loop over the number of samples}
			
			\For{$j\in\texttt{eachindex}(T)$}\Comment{Loop over the time points}
				\State{$X[i,j,1] \gets T[j]$}\Comment{Set the time points in first column}
			\EndFor
			\Statex
			\For{$j\in{1}~\text{to}~N_{a}$}\Comment{Loop over the number of assets in the portfolio $\mathcal{P}$}
				\State{$X[i,1,j+1] \gets \mathbf{S}_{\circ}[j]$}\Comment{Set the initial share price}
			\EndFor
			\Statex

			\For{$j\in{2}~\text{to}~N_{t}$}\Comment{Loop over the number of time steps}
				\For{$k\in{1}~\text{to}~N_{a}$}\Comment{Loop over the number of assets in the portfolio $\mathcal{P}$}
				\Statex
				\State{$\text{noise} \gets 0.0$}
				\For{$l\in{1}~\text{to}~N_{a}$}\Comment{Loop over the number of assets in the portfolio $\mathcal{P}$}
					\State{$\text{noise} \gets \text{noise} + \mathbf{A}[k,l]\cdot\texttt{rand}(\mathcal{Z})$}\Comment{Compute the noise term for asset $k$}
				\EndFor
				\Statex
				\State{$X[i,j,k+1] \gets X[i,j-1,k+1]\cdot\exp\Biggl[\left(\mu[k]-a_{kk}^{2}/{2}\right)\Delta{t} + \sqrt{\Delta{t}}\cdot\text{noise}\Biggr]$}
				\EndFor
			\EndFor
		\EndFor

		\EndProcedure
	\end{algorithmic}
\end{algorithm}

\subsection*{Wealth of a portfolio $\mathcal{P}$}
To compute the performance of a portfolio $\mathcal{P}$, we can use Algorithm \ref{algo-multi-asset-gbm-simulation} 
to simulate the share price of each firm in the portfolio $\mathcal{P}$ over a time-horizon, e.g., from now to until next year.
Given the share price of each firm in the portfolio $\mathcal{P}$ at each time point, we can compute what combinations of shares of each firm in the portfolio $\mathcal{P}$.	
However, to compute the wealth, we need to know the number of shares of each firm in the portfolio $\mathcal{P}$ at time $t$.
The number of shares of each firm in the portfolio $\mathcal{P}$ at time $t$ is given by the fraction of the total wealth invested in each firm in the portfolio $\mathcal{P}$.
Let's imagine a scenario where an investor has a total wealth of $W_{\text{total}}$ at time $t$, 
and the fraction of the total wealth invested in each firm $i\in\mathcal{P}$
is given by $0\leq{\omega_{i}}\leq{1}$, which is an element of the allocation vector $\omega_{i}\in\mathbf{\omega}$.
The fraction of the total wealth invested in each firm $i\in\mathcal{P}$ is given by:
\begin{equation*}
\omega_{i}(t) = \frac{W_{i}(t)}{W_{\text{total}}}\qquad\text{for}\quad{i\in\mathcal{P}}
\end{equation*}
where $W_{i}(t)$ denotes the wealth of firm $i\in\mathcal{P}$ at time $t$.
However, we know the total wealth at time $t$, is the liqidation value of the portfolio, thus, we can rewrite the fraction of the total wealth invested in each firm $i\in\mathcal{P}$ as:
\begin{equation*}
\omega_{i}(t) = \frac{n_{i}(t)\cdot{S_{i}(t)}}{\displaystyle\sum_{k\in\mathcal{P}}n_{k}(t)\cdot{S}_{k}(t)}\qquad\text{for}\quad{i\in\mathcal{P}}
\end{equation*}
The wealth of a portfolio $\mathcal{P}$ at time $t$ 
is given by the sum of the product of number of shares of firm $i$ with the share price of each firm in the portfolio $\mathcal{P}$ at time $t$:
\begin{equation*}
W(t) = \sum_{i\in\mathcal{P}}n_{i}(t)\cdot{S_{i}(t)}
\end{equation*}
where $n_{i}(t)$ denotes the number of shares of firm $i\in\mathcal{P}$ at time $t$.


\section*{Summary}
In this module, we have considered the multi-dimensional GBM model, 
which describes the share price of a firm in a portfolio $\mathcal{P}$.
We have shown how to estimate the drift vector $\mu$, the covariance matrix $\Sigma$, and the noise coefficients $a_{ij}$,
and provided an algorithm to simulate the multi-dimensional GBM model to predict the share price of a firm at a future time point.
Finally, we have shown how to compute the wealth of a portfolio $\mathcal{P}$ at time $t$, and its relationship 
to the fraction of the total wealth invested in each firm in the portfolio $\mathcal{P}$.
Later, we'll develop tools to compute these fractions, i.e., the portfolio weights, 
but for we'll consider the case where the portfolio weights are equal, or are chosen by the investor by some approach
(perhaps even randomly).

\bibliography{References_v1}

\clearpage
\printindex

\end{document}
